<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>바디올한의원 정밀진단 문진</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* 럭셔리 클리닉 디자인 시스템 */
    :root {
      --bg-color: #fcfcfd;
      --card-bg: #ffffff;
      --primary-color: #1e293b; /* 깊은 신뢰의 네이비 */
      --accent-color: #2563eb;  /* 전문적인 메디컬 블루 */
      --text-main: #0f172a;
      --text-muted: #64748b;
      --border-color: #e2e8f0;
      --input-bg: #f8fafc;
      --radius: 12px;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
    }

    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
    
    body {
      margin: 0;
      font-family: "Pretendard", -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      line-height: 1.6;
    }

    .container {
      max-width: 800px;
      margin: 40px auto;
      padding: 0 20px;
    }

    h1 {
      font-size: 28px;
      font-weight: 800;
      text-align: center;
      margin-bottom: 40px;
      letter-spacing: -1px;
      color: var(--primary-color);
    }

    h2 {
      font-size: 20px;
      font-weight: 700;
      margin-top: 60px;
      margin-bottom: 20px;
      color: var(--primary-color);
    }

    /* 카드 스타일 레이아웃 */
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 40px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
      margin-top: 16px;
    }

    .badge {
      display: inline-block;
      font-size: 12px;
      font-weight: 700;
      padding: 4px 12px;
      border-radius: 999px;
      background: #eff6ff;
      color: var(--accent-color);
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .intro-title {
      font-size: 22px;
      font-weight: 700;
      line-height: 1.4;
      margin-bottom: 16px;
      color: var(--text-main);
    }

    .hint {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .hint strong {
      color: var(--accent-color);
    }

    .intro-image {
      margin-top: 24px;
      border-radius: var(--radius);
      width: 100%;
      border: 1px solid var(--border-color);
    }

    .intro-list {
      list-style: none;
      padding: 0;
      margin: 30px 0;
      font-size: 15px;
    }

    .intro-list li {
      margin-bottom: 12px;
      padding-left: 24px;
      position: relative;
      color: #475569;
    }

    .intro-list li::before {
      content: "✓";
      position: absolute;
      left: 0;
      color: var(--accent-color);
      font-weight: 900;
    }

    /* 폼 요소 스타일 */
    fieldset {
      margin-bottom: 40px;
      padding: 30px;
      border-radius: var(--radius);
      border: 1px solid var(--border-color);
      background: #fff;
      transition: border-color 0.2s;
    }

    fieldset:focus-within {
      border-color: var(--accent-color);
    }

    legend {
      font-weight: 700;
      font-size: 15px;
      color: var(--accent-color);
      padding: 0 10px;
      background: #fff;
    }

    label {
      display: block;
      margin-top: 20px;
      font-size: 14px;
      font-weight: 600;
      color: #334155;
    }

    input[type="text"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      box-sizing: border-box;
      padding: 12px 16px;
      margin-top: 8px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--input-bg);
      transition: all 0.2s;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      background: #fff;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.05);
    }

    textarea { min-height: 100px; }

    .radio-group {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .radio-group label {
      margin-top: 0;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      transition: 0.2s;
    }

    .radio-group input[type="radio"] {
      margin: 0;
    }

    .radio-group label:hover {
      background: #f1f5f9;
    }

    /* 동의 박스 */
    .consent-box {
      font-size: 13px;
      background: #f8fafc;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      color: #475569;
      line-height: 1.7;
    }

    .consent-box ul {
      margin: 10px 0 0;
      padding-left: 20px;
    }

    .consent-checkbox-wrapper {
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      justify-content: center;
      padding: 10px;
    }

    /* 버튼 스타일 */
    button {
      padding: 14px 28px;
      cursor: pointer;
      border-radius: 8px;
      font-weight: 700;
      font-size: 15px;
      transition: all 0.2s;
      border: 1px solid var(--border-color);
      background: #fff;
    }

    button.primary {
      background: var(--primary-color);
      color: #fff;
      border: none;
      width: 100%;
      margin-top: 20px;
      font-size: 16px;
      box-shadow: 0 4px 12px rgba(30, 41, 59, 0.15);
    }

    button.primary:hover {
      background: #000;
      transform: translateY(-1px);
    }

    button.start-btn {
      width: 100%;
      margin-top: 20px;
      padding: 16px;
      background: var(--accent-color);
      color: #fff;
      border: none;
      font-size: 16px;
    }

    button.start-btn:hover {
      background: #1d4ed8;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    }

    #output {
      width: 100%;
      min-height: 200px;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      padding: 15px;
      font-family: 'Courier New', Courier, monospace;
      color: #334155;
    }

    .hidden { display: none; }

    @media (max-width: 600px) {
      .card { padding: 25px; }
      fieldset { padding: 15px; }
      .radio-group { flex-direction: column; }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>바디올한의원 P-code 문진</h1>

    <div id="intro" class="card">
      <div class="badge">P-code 심층검사 · 대표원장 직접 분석</div>
      <p class="intro-title">
        “ 건강관리 • 질병진단 "<br>
        " 현대 한의학으로 심층분석해드립니다. ”
      </p>
      
      <p class="hint">
        <strong>★★필독★★</strong><br>    
        <strong>[설문 완료]→[파란 버튼]→[자동 병원카톡 이동됨]<br>
          ->[채팅창 길게 눌러 붙여넣기]→[카톡메시지 전송]<br>
          →[간편진단예약 완료]</strong><br>
        <br>
        위 순서로 해주셔야, 예약누락이 없습니다.<br>
        마지막에 실제 방법이 잘 나와있습니다.<br>
        진단예약 누락되지않도록 해주세요 ^^
      </p>

      <img class="intro-image" src="https://raw.githubusercontent.com/bodyallhani/herbmed0/main/jinmak.jpg" alt="진맥 이미지" />

      <ul class="intro-list">
        <li>해당 페이지는 <strong>P-code 진단 효율을 위해 제작된 요약 프로그램</strong>입니다.</li>
        <li><strong>한의사가 직접 해석</strong>해야 하는 문진표입니다.</li>
        <li><strong>최종응답 버튼</strong>을 누르면 응답 내용이 <strong>자동복사</strong>되고 <strong>카카오채널</strong>로 이동합니다.</li>
      </ul>

      <button type="button" class="start-btn" onclick="startSurvey()">
        심층 문진 시작하기
      </button>
    </div>

    <div id="formContainer" class="hidden">
      <div class="card" style="margin-bottom:24px; border-left: 4px solid var(--accent-color);">
        <p class="step-label" style="font-weight:700; margin:0;">1분 정밀 문진</p>
        <p class="hint" style="margin-top:5px; margin-bottom:0;">잘 모르겠는 항목은 비워두셔도 됩니다. 자세히 쓸수록 진단이 명확해집니다.</p>
      </div>

      <form id="intakeForm">
        <fieldset>
          <legend>기본정보</legend>
          <label><strong>바디올한의원에 현재 계시거나, 내원하신 적이 있으신가요?</strong></label>
          <div class="radio-group">
            <label><input type="radio" name="visitStatus" value="O" /> 네</label>
            <label><input type="radio" name="visitStatus" value="X" /> 아니오</label>
            <label><input type="radio" name="visitStatus" value="?" /> 잘 모름</label>
          </div>

          <label><strong>이름:</strong>
            <input type="text" id="name" placeholder="'익명' 가능. / 단, 실제 치료시에는 '실명'필요." />
          </label>
          <label><strong>나이:</strong>
            <input type="number" id="age" min="1" max="120" />
          </label>
          <label><strong>성별:</strong>
            <select id="gender">
              <option value="">선택</option>
              <option value="남성">남성</option>
              <option value="여성">여성</option>
              <option value="기타/응답하지 않음">기타/응답하지 않음</option>
            </select>
          </label>
          <label>직업/생활패턴 (근무형태, 앉아있는 시간, 야근/교대 등):
            <textarea id="job"></textarea>
          </label>
          <label>근무 형태:
            <input type="text" id="workType" placeholder="예: 주간근무 / 교대근무 / 야간근무 등" />
          </label>
          <label>평균 수면 시간:
            <input type="text" id="sleepHours" placeholder="예: 평일 6시간, 주말 8시간 등" />
          </label>
          <label>카페인 섭취:
            <input type="text" id="caffeine" placeholder="예: 커피 하루 1~2잔, 에너지드링크 등" />
          </label>
          <label>음주 습관:
            <input type="text" id="alcohol" placeholder="예: 거의 안 마심 / 주 1회 소량 / 주 3회 이상 등" />
          </label>
          <label>운동 여부:
            <input type="text" id="exercise" placeholder="예: 안 함 / 주 2회 걷기 / 헬스 주 3회 등" />
          </label>
        </fieldset>

        <fieldset>
          <legend>주증상</legend>
          <label>가장 불편한 증상 1:
            <input type="text" id="mainSymptom1" placeholder="예: 어지럼, 두근거림, 수면장애 등" />
          </label>
          <label>불편한 증상 2:
            <input type="text" id="mainSymptom2" />
          </label>
          <label>불편한 증상 3:
            <input type="text" id="mainSymptom3" />
          </label>
          <label>증상은 언제부터 시작되었나요? (발병 시기, 계기):
            <textarea id="onset" placeholder="예: 3개월 전 회사 스트레스 이후, 코로나 감염 이후 등"></textarea>
          </label>
        </fieldset>

        <fieldset>
          <legend>증상양상</legend>
          <label>하루 중 어느 시간대에 가장 심한가요?
            <input type="text" id="worseTime" placeholder="예: 아침 기상 직후 / 오후 3~5시 / 밤 / 일정치 않음 등" />
          </label>
          <label>증상을 악화시키는 요인 (여러 개 가능):
            <textarea id="triggers" placeholder="예: 스트레스, 누웠다 일어날 때, 샤워, 사람 많은 곳, 카페인, 운동 등"></textarea>
          </label>
          <label>증상을 완화시키는 요인:
            <textarea id="relievers" placeholder="예: 누워있기, 깊은 호흡, 휴식, 약 복용 등"></textarea>
          </label>
          <label>증상 강도 변화 패턴:
            <textarea id="pattern" placeholder="예: 좋을 때 나쁠 때가 번갈아 옴, 특정 날에만 심함 등"></textarea>
          </label>
        </fieldset>

        <fieldset>
          <legend>전신 증상 (0~10)</legend>
          <p class="hint">0 = 전혀 없음, 10 = 가장 심함</p>
          <label>피로감:
            <input type="number" id="fatigue" min="0" max="10" />
          </label>
          <label>어지럼/띵함:
            <input type="number" id="dizziness" min="0" max="10" />
          </label>
          <label>두근거림/심계:
            <input type="number" id="palpitation" min="0" max="10" />
          </label>
          <label>불안/초조:
            <input type="number" id="anxiety" min="0" max="10" />
          </label>
          <label>기립 시 불편감(누웠다 일어날 때 핑 도는 느낌 등):
            <input type="number" id="orthostatic" min="0" max="10" />
          </label>
          <label>손발 저림/감각이상:
            <input type="number" id="numbness" min="0" max="10" />
          </label>
        </fieldset>

        <fieldset>
          <legend>수면</legend>
          <label>잠들기까지 보통 어느 정도 걸리나요? (입면 문제):
            <textarea id="sleepOnset" placeholder="예: 10~20분, 1시간 이상, 눕자마자 잠 등"></textarea>
          </label>
          <label>밤중에 자주 깨거나, 꿈이 많나요?
            <textarea id="sleepMiddle" placeholder="예: 두세 번 깸, 악몽이 잦음, 거의 안 깸 등"></textarea>
          </label>
          <label>숙면감 (0~10):
            <input type="number" id="sleepQuality" min="0" max="10" />
          </label>
          <label>아침에 일어났을 때 상태:
            <textarea id="sleepMorning" placeholder="예: 개운하다 / 머리가 무겁다 / 몸이 납처럼 무겁다 등"></textarea>
          </label>
        </fieldset>

        <fieldset>
          <legend>소화기</legend>
          <label>식욕 상태:
            <input type="text" id="appetite" placeholder="예: 정상 / 감소 / 과식 경향 등" />
          </label>
          <label>식사 후 더부룩함:
            <textarea id="bloating" placeholder="언제, 어떤 음식에서 더 심한지 등"></textarea>
          </label>
          <label>식후 졸림/멍함:
            <textarea id="postMeal" placeholder="예: 식사 후 항상 졸리다, 특정 경우만 그렇다 등"></textarea>
          </label>
          <label>속쓰림/메스꺼움:
            <textarea id="nausea"></textarea>
          </label>
          <label>대변 상태 (모양, 횟수, 설사/변비, 묽음/토막변 등):
            <textarea id="stool"></textarea>
          </label>
        </fieldset>

        <fieldset>
          <legend>자율신경 관련</legend>
          <label>손발이 차갑거나 뜨거운 편인가요?
            <textarea id="extremitiesTemp"></textarea>
          </label>
          <label>땀 (많이 남/거의 안 남/식은땀 등):
            <textarea id="sweating"></textarea>
          </label>
          <label>온도/날씨 변화에 민감하신가요?
            <textarea id="tempSensitivity"></textarea>
          </label>
          <label>호흡 패턴 (숨이 짧다, 한숨을 자주 쉰다, 가슴 답답하다 등):
            <textarea id="breathing"></textarea>
          </label>
          <label>소리/조명/냄새 등에 예민한 편인가요?
            <textarea id="sensitivity"></textarea>
          </label>
        </fieldset>

        <fieldset>
          <legend>부인과 (여성 전용)</legend>
          <label>생리 주기/양/통증, 생리 전후 변화:
            <textarea id="gyne"></textarea>
          </label>
          <label>임신/출산/유산 경험, 피임약 복용 여부:
            <textarea id="gyne2"></textarea>
          </label>
        </fieldset>

        <fieldset>
          <legend>통증/근골격</legend>
          <label>목/어깨/등/허리 통증 여부와 양상:
            <textarea id="pain"></textarea>
          </label>
          <label>아침에 일어났을 때 뻣뻣함 여부:
            <textarea id="morningStiffness"></textarea>
          </label>
          <label>같은 부위를 반복해서 삐끗하거나 다치는 편인가요?
            <textarea id="reinjury"></textarea>
          </label>
          <label>기존 교정/도수/추나 치료 경험:
            <textarea id="manualTxHistory"></textarea>
          </label>
          <label>운동 시 통증 패턴:
            <textarea id="exercisePain"></textarea>
          </label>
        </fieldset>

        <fieldset>
          <legend>기존 진단/복용약/가족력</legend>
          <label>지금까지 병원에서 들은 진단명:
            <textarea id="diagnosis"></textarea>
          </label>
          <label>현재 복용 중인 약 (양약, 한약, 건강기능식품 포함):
            <textarea id="meds"></textarea>
          </label>
          <label>수술/입원 경험:
            <textarea id="surgery"></textarea>
          </label>
          <label>가족 중 유사 증상이나 만성질환(가족력):
            <textarea id="familyHistory"></textarea>
          </label>
        </fieldset>

        <fieldset>
          <legend>기타</legend>
          <label>특히 걱정되거나, 꼭 말씀하고 싶은 내용:
            <textarea id="etc"></textarea>
          </label>
        </fieldset>

        <fieldset style="background:#f1f5f9; border:none;">
          <legend style="background:#f1f5f9;">개인정보 동의</legend>
          <div class="consent-box">
            <p style="margin:0 0 10px; font-weight:700;">개인정보 수집·이용 동의 안내</p>
            <ul>
              <li>① 목적: 진료 상담 및 진료 여부 판단, 추후 치료 계획 수립</li>
              <li>② 수집 항목: 상기 문진표에 작성한 내용 일체</li>
              <li>③ 보유 기간: 상담 종료 후 최대 5년 (관련 법령에 따른 기간 내)</li>
            </ul>
          </div>
          <div class="consent-checkbox-wrapper">
            <input type="checkbox" id="privacyConsent" />
            <label for="privacyConsent" style="margin:0;"><strong>위 개인정보 수집·이용에 동의합니다.</strong></label>
          </div>
        </fieldset>

        <button type="button" class="primary start-btn" id="allInOneBtn">응답요약 및 복사하기</button>
        <button type="reset" style="width:100%; border:none; color:var(--text-muted); background:none; font-size:13px; margin-top:10px;">입력 초기화</button>
      </form>
    </div>

    <div class="card" id="outputContainer" style="margin-top:40px;">
      <h2>문진 텍스트 결과</h2>
      <p class="hint">아래 내용은 자동으로 복사되었습니다. 카카오 채널 채팅창에 붙여넣어 주세요.</p>
      <textarea id="output" readonly></textarea>
      <button type="button" class="primary" style="margin-top:10px;" onclick="copyOutput()">텍스트 다시 복사하기</button>
    </div>
  </div>

  <script>
    const FORM_ENDPOINT = "https://script.google.com/macros/s/AKfycbw9gPpp33Flc-QAsd7PdPDjeOGGKkjJqcivUL3wYvpp2qVxBQj-crVRKsx84OuPuEXL/exec";
    const KAKAO_URL = "https://pf.kakao.com/_wdtXK/chat";

    function v(id) { return (document.getElementById(id).value || "").trim(); }

    function getVisitStatus() {
      const radios = document.querySelectorAll('input[name="visitStatus"]');
      for (const r of radios) { if (r.checked) return r.value; }
      return "";
    }

    function formatKoreanDateTime(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, "0");
      const d = String(date.getDate()).padStart(2, "0");
      const hh = String(date.getHours()).padStart(2, "0");
      const mm = String(date.getMinutes()).padStart(2, "0");
      const ss = String(date.getSeconds()).padStart(2, "0");
      return y + "." + m + "." + d + " " + hh + ":" + mm + ":" + ss;
    }

    function collectFormData() {
      const ids = [
        "name","age","gender","job","workType","sleepHours","caffeine","alcohol","exercise",
        "mainSymptom1","mainSymptom2","mainSymptom3","onset",
        "worseTime","triggers","relievers","pattern",
        "fatigue","dizziness","palpitation","anxiety","orthostatic","numbness",
        "sleepOnset","sleepMiddle","sleepQuality","sleepMorning",
        "appetite","bloating","postMeal","nausea","stool",
        "extremitiesTemp","sweating","tempSensitivity","breathing","sensitivity",
        "gyne","gyne2",
        "pain","morningStiffness","reinjury","manualTxHistory","exercisePain",
        "diagnosis","meds","surgery","familyHistory","etc"
      ];
      const data = {};
      ids.forEach(id => data[id] = v(id));
      data.visitStatus = getVisitStatus();
      return data;
    }

    function sendToServer(data) {
      const formBody = new URLSearchParams(data).toString();
      fetch(FORM_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: formBody
      }).catch(err => console.error("Error:", err));
    }

    function buildSummary(consentTime) {
      const l = [];
      const vs = getVisitStatus();
      l.push("[개인정보 동의: " + consentTime + "]\n");
      l.push("[내원여부]: " + vs + "\n");
      l.push("[기본정보]\n- 성함: " + v("name") + "\n- 나이/성별: " + v("age") + "/" + v("gender"));
      l.push("- 생활패턴: " + v("job") + "\n- 근무/수면: " + v("workType") + "/" + v("sleepHours"));
      l.push("- 카페인/음주/운동: " + v("caffeine") + "/" + v("alcohol") + "/" + v("exercise") + "\n");
      l.push("[주증상]\n- " + v("mainSymptom1") + ", " + v("mainSymptom2") + ", " + v("mainSymptom3"));
      l.push("- 시기/계기: " + v("onset") + "\n");
      l.push("[양상/전신]\n- 시간대: " + v("worseTime") + "\n- 악화/완화: " + v("triggers") + " / " + v("relievers"));
      l.push("- 피로/어지럼/두근/불안/기립/저림: " + v("fatigue") + "/" + v("dizziness") + "/" + v("palpitation") + "/" + v("anxiety") + "/" + v("orthostatic") + "/" + v("numbness") + "\n");
      l.push("[수면/소화]\n- 입면/각성: " + v("sleepOnset") + "/" + v("sleepMiddle") + "\n- 숙면/기상상태: " + v("sleepQuality") + "/" + v("sleepMorning"));
      l.push("- 식욕/더부룩: " + v("appetite") + "/" + v("bloating") + "\n- 졸림/메스껍/대변: " + v("postMeal") + "/" + v("nausea") + "/" + v("stool") + "\n");
      l.push("[자율/통증]\n- 손발/땀/온도: " + v("extremitiesTemp") + "/" + v("sweating") + "/" + v("tempSensitivity"));
      l.push("- 호흡/예민: " + v("breathing") + "/" + v("sensitivity"));
      l.push("- 부인과: " + v("gyne") + " " + v("gyne2"));
      l.push("- 통증부위: " + v("pain") + "\n- 아침뻣뻣/반복/경험: " + v("morningStiffness") + "/" + v("reinjury") + "/" + v("manualTxHistory") + "/" + v("exercisePain") + "\n");
      l.push("[과거력/기타]\n- 진단명/약: " + v("diagnosis") + "/" + v("meds"));
      l.push("- 수술/가족력: " + v("surgery") + "/" + v("familyHistory"));
      l.push("- 기타: " + v("etc"));
      return l.join("\n");
    }

    function copyText(text) {
      const temp = document.createElement("textarea");
      temp.style.position = "fixed";
      temp.value = text;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      document.body.removeChild(temp);
    }

    function copyOutput() {
      copyText(document.getElementById("output").value);
      alert("복사되었습니다. 카카오톡에 붙여넣어 주세요.");
    }

    function startSurvey() {
      document.getElementById("intro").classList.add("hidden");
      document.getElementById("formContainer").classList.remove("hidden");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    document.getElementById("allInOneBtn").addEventListener("click", function () {
      if (!document.getElementById("privacyConsent").checked) {
        alert("개인정보 수집·이용에 동의해 주세요.");
        return;
      }
      this.disabled = true;
      this.textContent = "처리 중...";
      const now = new Date();
      const summaryText = buildSummary(formatKoreanDateTime(now));
      document.getElementById("output").value = summaryText;
      copyText(summaryText);
      const data = collectFormData();
      data.summary_text = summaryText;
      sendToServer(data);
      alert("문진 요약이 복사되었습니다. 카카오톡 채팅창에 붙여넣어 주세요.");
      window.location.href = KAKAO_URL;
    });
  </script>
</body>
</html>
