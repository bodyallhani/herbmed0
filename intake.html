<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>바디올한의원 정밀진단 문진</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* 럭셔리 클리닉 디자인 시스템 */
    :root {
      --bg-color: #fcfcfd;
      --card-bg: #ffffff;
      --primary-color: #1e293b; /* 깊은 신뢰의 네이비 */
      --accent-color: #2563eb;  /* 전문적인 메디컬 블루 */
      --text-main: #0f172a;
      --text-muted: #64748b;
      --border-color: #e2e8f0;
      --input-bg: #f8fafc;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.04);
    }

    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
    
    body {
      margin: 0;
      font-family: "Pretendard Variable", Pretendard, -apple-system, system-ui, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      line-height: 1.6;
    }

    .container {
      max-width: 800px;
      margin: 40px auto;
      padding: 0 20px;
    }

    h1 {
      font-size: 24px;
      font-weight: 800;
      text-align: center;
      margin-bottom: 40px;
      letter-spacing: -1px;
      color: var(--primary-color);
      opacity: 0.8;
    }

    /* 인트로 카드 스타일 강화 */
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 48px 40px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
      margin-top: 16px;
    }

    .badge {
      display: inline-block;
      font-size: 11px;
      font-weight: 800;
      padding: 6px 14px;
      border-radius: 999px;
      background: #eff6ff;
      color: var(--accent-color);
      margin-bottom: 20px;
      letter-spacing: 1px;
    }

    /* 메인 타이틀 정리 */
    .intro-title {
      font-size: clamp(22px, 5vw, 28px);
      font-weight: 800;
      line-height: 1.35;
      margin-bottom: 24px;
      color: var(--text-main);
      word-break: keep-all;
    }

    /* 필독 사항 프로세스 시각화 */
    .process-box {
      background: #f8fafc;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 32px;
      border: 1px solid #e2e8f0;
    }
    .process-box strong.label {
      color: #e11d48; /* 주의를 끄는 레드 */
      font-size: 13px;
      display: block;
      margin-bottom: 12px;
      letter-spacing: 1px;
    }
    .process-steps {
      font-size: 15px;
      font-weight: 700;
      line-height: 1.6;
      color: #334155;
    }
    .process-steps span {
      display: inline-block;
      color: var(--accent-color);
      margin: 0 4px;
    }

    .intro-image {
      margin: 32px 0;
      border-radius: 12px;
      width: 100%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .intro-list {
      list-style: none;
      padding: 0;
      margin: 32px 0;
      border-top: 1px solid var(--border-color);
      padding-top: 24px;
    }
    .intro-list li {
      margin-bottom: 14px;
      padding-left: 28px;
      position: relative;
      font-size: 15px;
      color: #475569;
      font-weight: 500;
    }
    .intro-list li::before {
      content: "•";
      position: absolute;
      left: 8px;
      color: var(--accent-color);
      font-weight: 900;
    }

    /* 폼 요소 스타일 (보존) */
    fieldset {
      margin-bottom: 40px;
      padding: 30px;
      border-radius: var(--radius);
      border: 1px solid var(--border-color);
      background: #fff;
    }
    legend { font-weight: 700; font-size: 15px; color: var(--accent-color); padding: 0 10px; background: #fff; }
    label { display: block; margin-top: 20px; font-size: 14px; font-weight: 600; }
    input[type="text"], input[type="number"], textarea, select {
      width: 100%; padding: 12px 16px; margin-top: 8px; font-size: 15px;
      border-radius: 8px; border: 1px solid var(--border-color); background: var(--input-bg);
    }
    .radio-group { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 12px; }
    .radio-group label {
      padding: 10px 16px; background: var(--input-bg); border: 1px solid var(--border-color);
      border-radius: 8px; cursor: pointer; font-weight: 500;
    }

    /* 버튼 스타일 */
    button {
      padding: 18px 28px;
      cursor: pointer;
      border-radius: 12px;
      font-weight: 800;
      font-size: 16px;
      transition: all 0.2s;
      border: none;
    }
    button.primary {
      background: var(--primary-color);
      color: #fff;
      width: 100%;
    }
    button.start-btn {
      width: 100%;
      background: var(--accent-color);
      color: #fff;
      box-shadow: 0 8px 16px rgba(37, 99, 235, 0.2);
    }
    button.start-btn:hover { background: #1d4ed8; transform: translateY(-1px); }

    #output { width: 100%; min-height: 200px; background: var(--input-bg); border: 1px solid var(--border-color); padding: 15px; font-size: 13px; }
    .hidden { display: none; }
  </style>
</head>
<body>

  <div class="container">
    <h1>바디올한의원 P-code 문진</h1>

    <div id="intro" class="card">
      <div class="badge">P-CODE DEEP ANALYSIS</div>
      
      <p class="intro-title">
        단순한 증상 나열이 아닌,<br>
        <strong>현대 한의학 데이터</strong>로 당신의 건강을<br>
        정밀하게 분석해 드립니다.
      </p>
      
      <div class="process-box">
        <strong class="label">⚠️ 반드시 확인해 주세요 (예약 필수 단계)</strong>
        <div class="process-steps">
          1. 설문 완료 후 <span>[파란색 버튼]</span> 클릭<br>
          2. 카카오톡 채팅창이 열리면 <span>[붙여넣기]</span><br>
          3. 메시지 <span>[전송]</span> 시 진단 예약 최종 완료
        </div>
        <p style="font-size: 13px; color: #64748b; margin-top: 12px; margin-bottom: 0;">
          * 위 순서대로 진행하셔야 예약 누락이 발생하지 않습니다.
        </p>
      </div>

      <img class="intro-image" src="https://raw.githubusercontent.com/bodyallhani/herbmed0/main/jinmak.jpg" alt="바디올 정밀 진단" />

      <ul class="intro-list">
        <li>본 프로그램은 <strong>대표원장 직접 분석</strong>을 위해 설계되었습니다.</li>
        <li>한의사가 진료 전 상태를 파악하는 <strong>심층 변증용 문진표</strong>입니다.</li>
        <li>모든 응답은 개인정보 보호법에 따라 <strong>안전하게 관리</strong>됩니다.</li>
      </ul>

      <button type="button" class="start-btn" onclick="startSurvey()">
        심층 문진 시작하기
      </button>
    </div>

    <div id="formContainer" class="hidden">
      <div class="card" style="margin-bottom:24px; border-left: 4px solid var(--accent-color); padding: 24px 32px;">
        <p style="font-weight:800; font-size: 18px; margin:0; color: var(--primary-color);">1분 정밀 문진</p>
        <p style="margin-top:4px; margin-bottom:0; font-size: 14px; color: var(--text-muted);">
          잘 모르겠는 항목은 비워두셔도 되지만,<br><strong>상세히 기재할수록</strong> 진단 결과는 더욱 정밀해집니다.
        </p>
      </div>

      <form id="intakeForm">
        <fieldset>
          <legend>기본정보</legend>
          <label><strong>바디올한의원에 현재 계시거나, 내원하신 적이 있으신가요?</strong></label>
          <div class="radio-group">
            <label><input type="radio" name="visitStatus" value="O" /> 네</label>
            <label><input type="radio" name="visitStatus" value="X" /> 아니오</label>
            <label><input type="radio" name="visitStatus" value="?" /> 잘 모름</label>
          </div>

          <label><strong>이름:</strong>
            <input type="text" id="name" placeholder="'익명' 가능. / 단, 실제 치료시에는 '실명'필요." />
          </label>
          <label><strong>나이:</strong>
            <input type="number" id="age" min="1" max="120" />
          </label>
          <label><strong>성별:</strong>
            <select id="gender">
              <option value="">선택</option>
              <option value="남성">남성</option>
              <option value="여성">여성</option>
              <option value="기타/응답하지 않음">기타/응답하지 않음</option>
            </select>
          </label>
          <label>직업/생활패턴 (근무형태, 앉아있는 시간, 야근/교대 등):
            <textarea id="job"></textarea>
          </label>
          <label>근무 형태:
            <input type="text" id="workType" placeholder="예: 주간근무 / 교대근무 / 야간근무 등" />
          </label>
          <label>평균 수면 시간:
            <input type="text" id="sleepHours" placeholder="예: 평일 6시간, 주말 8시간 등" />
          </label>
          <label>카페인 섭취:
            <input type="text" id="caffeine" placeholder="예: 커피 하루 1~2잔, 에너지드링크 등" />
          </label>
          <label>음주 습관:
            <input type="text" id="alcohol" placeholder="예: 거의 안 마심 / 주 1회 소량 / 주 3회 이상 등" />
          </label>
          <label>운동 여부:
            <input type="text" id="exercise" placeholder="예: 안 함 / 주 2회 걷기 / 헬스 주 3회 등" />
          </label>
        </fieldset>

        <fieldset>
          <legend>주증상</legend>
          <label>가장 불편한 증상 1:
            <input type="text" id="mainSymptom1" placeholder="예: 어지럼, 두근거림, 수면장애 등" />
          </label>
          <label>불편한 증상 2:
            <input type="text" id="mainSymptom2" />
          </label>
          <label>불편한 증상 3:
            <input type="text" id="mainSymptom3" />
          </label>
          <label>증상은 언제부터 시작되었나요? (발병 시기, 계기):
            <textarea id="onset" placeholder="예: 3개월 전 회사 스트레스 이후, 코로나 감염 이후 등"></textarea>
          </label>
        </fieldset>

        <fieldset>
          <legend>증상양상</legend>
          <label>하루 중 어느 시간대에 가장 심한가요?
            <input type="text" id="worseTime" placeholder="예: 아침 기상 직후 / 오후 3~5시 / 밤 / 일정치 않음 등" />
          </label>
          <label>증상을 악화시키는 요인 (여러 개 가능):
            <textarea id="triggers" placeholder="예: 스트레스, 누웠다 일어날 때, 샤워, 사람 많은 곳, 카페인, 운동 등"></textarea>
          </label>
          <label>증상을 완화시키는 요인:
            <textarea id="relievers" placeholder="예: 누워있기, 깊은 호흡, 휴식, 약 복용 등"></textarea>
          </label>
          <label>증상 강도 변화 패턴:
            <textarea id="pattern" placeholder="예: 좋을 때 나쁠 때가 번갈아 옴, 특정 날에만 심함 등"></textarea>
          </label>
        </fieldset>

        <fieldset>
          <legend>전신 증상 (0~10)</legend>
          <p class="hint">0 = 전혀 없음, 10 = 가장 심함</p>
          <label>피로감:
            <input type="number" id="fatigue" min="0" max="10" />
          </label>
          <label>어지럼/띵함:
            <input type="number" id="dizziness" min="0" max="10" />
          </label>
          <label>두근거림/심계:
            <input type="number" id="palpitation" min="0" max="10" />
          </label>
          <label>불안/초조:
            <input type="number" id="anxiety" min="0" max="10" />
          </label>
          <label>기립 시 불편감(누웠다 일어날 때 핑 도는 느낌 등):
            <input type="number" id="orthostatic" min="0" max="10" />
          </label>
          <label>손발 저림/감각이상:
            <input type="number" id="numbness" min="0" max="10" />
          </label>
        </fieldset>

        <fieldset><legend>수면</legend><label>잠들기까지 시간:</label><textarea id="sleepOnset"></textarea><label>밤중 각성/꿈:</label><textarea id="sleepMiddle"></textarea><label>숙면감(0~10):</label><input type="number" id="sleepQuality" min="0" max="10"/><label>기상 시 상태:</label><textarea id="sleepMorning"></textarea></fieldset>
        <fieldset><legend>소화기</legend><label>식욕:</label><input type="text" id="appetite"/><label>식후 더부룩함:</label><textarea id="bloating"></textarea><label>식후 졸림/멍함:</label><textarea id="postMeal"></textarea><label>속쓰림/메스꺼움:</label><textarea id="nausea"></textarea><label>대변상태:</label><textarea id="stool"></textarea></fieldset>
        <fieldset><legend>자율신경</legend><label>손발 온도:</label><textarea id="extremitiesTemp"></textarea><label>땀:</label><textarea id="sweating"></textarea><label>온도민감도:</label><textarea id="tempSensitivity"></textarea><label>호흡패턴:</label><textarea id="breathing"></textarea><label>예민도:</label><textarea id="sensitivity"></textarea></fieldset>
        <fieldset><legend>부인과 (여성전용)</legend><label>생리양상:</label><textarea id="gyne"></textarea><label>임신/출산/기타:</label><textarea id="gyne2"></textarea></fieldset>
        <fieldset><legend>통증/근골격</legend><label>통증양상:</label><textarea id="pain"></textarea><label>아침뻣뻣함:</label><textarea id="morningStiffness"></textarea><label>반복적다침:</label><textarea id="reinjury"></textarea><label>기존치료경험:</label><textarea id="manualTxHistory"></textarea><label>운동통증:</label><textarea id="exercisePain"></textarea></fieldset>
        <fieldset><legend>과거력/복용약</legend><label>기존진단명:</label><textarea id="diagnosis"></textarea><label>현재복용약:</label><textarea id="meds"></textarea><label>수술/입원:</label><textarea id="surgery"></textarea><label>가족력:</label><textarea id="familyHistory"></textarea></fieldset>
        <fieldset><legend>기타</legend><label>전달하고 싶은 내용:</label><textarea id="etc"></textarea></fieldset>

        <fieldset style="background:#f8fafc; border-color: #cbd5e1;">
          <legend style="background:#f8fafc;">개인정보 동의</legend>
          <div class="consent-box">
            <p style="margin:0 0 10px; font-weight:700;">개인정보 수집·이용 동의 안내</p>
            <ul>
              <li>① 목적: 진료 상담 및 진료 여부 판단, 추후 치료 계획 수립</li>
              <li>② 수집 항목: 상기 문진표에 작성한 내용 일체</li>
              <li>③ 보유 기간: 상담 종료 후 최대 5년 (관련 법령에 따른 기간 내)</li>
            </ul>
          </div>
          <div class="consent-checkbox-wrapper">
            <input type="checkbox" id="privacyConsent" />
            <label for="privacyConsent" style="margin:0; font-weight: 700;">위 개인정보 수집·이용에 동의합니다.</label>
          </div>
        </fieldset>

        <button type="button" class="primary start-btn" id="allInOneBtn" style="padding: 24px;">응답요약 및 카톡으로 전송하기</button>
        <button type="reset" style="width:100%; border:none; color:var(--text-muted); background:none; font-size:13px; margin-top:16px; cursor:pointer;">입력 내용 초기화</button>
      </form>
    </div>

    <div class="card" id="outputContainer" style="margin-top:40px;">
      <h2 style="margin-top: 0;">문진 텍스트 결과</h2>
      <p class="hint">아래 내용은 자동으로 복사되었습니다. 카카오 채널 채팅창에 바로 <strong>붙여넣기</strong> 해주세요.</p>
      <textarea id="output" readonly></textarea>
      <button type="button" class="primary" style="margin-top:10px; background: #64748b;" onclick="copyOutput()">텍스트 다시 복사하기</button>
    </div>
  </div>

  <script>
    const FORM_ENDPOINT = "https://script.google.com/macros/s/AKfycbw9gPpp33Flc-QAsd7PdPDjeOGGKkjJqcivUL3wYvpp2qVxBQj-crVRKsx84OuPuEXL/exec";
    const KAKAO_URL = "https://pf.kakao.com/_wdtXK/chat";

    function v(id) { return (document.getElementById(id).value || "").trim(); }

    function getVisitStatus() {
      const radios = document.querySelectorAll('input[name="visitStatus"]');
      for (const r of radios) { if (r.checked) return r.value; }
      return "";
    }

    function formatKoreanDateTime(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, "0");
      const d = String(date.getDate()).padStart(2, "0");
      const hh = String(date.getHours()).padStart(2, "0");
      const mm = String(date.getMinutes()).padStart(2, "0");
      return y + "." + m + "." + d + " " + hh + ":" + mm;
    }

    function collectFormData() {
      const ids = [
        "name","age","gender","job","workType","sleepHours","caffeine","alcohol","exercise",
        "mainSymptom1","mainSymptom2","mainSymptom3","onset",
        "worseTime","triggers","relievers","pattern",
        "fatigue","dizziness","palpitation","anxiety","orthostatic","numbness",
        "sleepOnset","sleepMiddle","sleepQuality","sleepMorning",
        "appetite","bloating","postMeal","nausea","stool",
        "extremitiesTemp","sweating","tempSensitivity","breathing","sensitivity",
        "gyne","gyne2",
        "pain","morningStiffness","reinjury","manualTxHistory","exercisePain",
        "diagnosis","meds","surgery","familyHistory","etc"
      ];
      const data = {};
      ids.forEach(id => data[id] = v(id));
      data.visitStatus = getVisitStatus();
      return data;
    }

    function sendToServer(data) {
      const formBody = new URLSearchParams(data).toString();
      fetch(FORM_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: formBody
      }).catch(err => console.error("Error:", err));
    }

    function buildSummary(consentTime) {
      const l = [];
      const vs = getVisitStatus();
      l.push("[개인정보 동의: " + consentTime + "]\n");
      l.push("[내원여부]: " + vs + "\n");
      l.push("[기본정보]\n- 성함: " + v("name") + "\n- 나이/성별: " + v("age") + "/" + v("gender"));
      l.push("- 생활패턴: " + v("job") + "\n- 근무/수면: " + v("workType") + "/" + v("sleepHours"));
      l.push("- 카페인/음주/운동: " + v("caffeine") + "/" + v("alcohol") + "/" + v("exercise") + "\n");
      l.push("[주증상]\n- " + v("mainSymptom1") + ", " + v("mainSymptom2") + ", " + v("mainSymptom3"));
      l.push("- 시기/계기: " + v("onset") + "\n");
      l.push("[양상/전신]\n- 시간대: " + v("worseTime") + "\n- 악화/완화: " + v("triggers") + " / " + v("relievers"));
      l.push("- 피로/어지럼/두근/불안/기립/저림: " + v("fatigue") + "/" + v("dizziness") + "/" + v("palpitation") + "/" + v("anxiety") + "/" + v("orthostatic") + "/" + v("numbness") + "\n");
      l.push("[수면/소화]\n- 입면/각성: " + v("sleepOnset") + "/" + v("sleepMiddle") + "\n- 숙면/기상상태: " + v("sleepQuality") + "/" + v("sleepMorning"));
      l.push("- 식욕/더부룩: " + v("appetite") + "/" + v("bloating") + "\n- 졸림/메스껍/대변: " + v("postMeal") + "/" + v("nausea") + "/" + v("stool") + "\n");
      l.push("[자율/통증]\n- 손발/땀/온도: " + v("extremitiesTemp") + "/" + v("sweating") + "/" + v("tempSensitivity"));
      l.push("- 호흡/예민: " + v("breathing") + "/" + v("sensitivity"));
      l.push("- 부인과: " + v("gyne") + " " + v("gyne2"));
      l.push("- 통증부위: " + v("pain") + "\n- 아침뻣뻣/반복/경험: " + v("morningStiffness") + "/" + v("reinjury") + "/" + v("manualTxHistory") + "/" + v("exercisePain") + "\n");
      l.push("[과거력/기타]\n- 진단명/약: " + v("diagnosis") + "/" + v("meds"));
      l.push("- 수술/가족력: " + v("surgery") + "/" + v("familyHistory"));
      l.push("- 기타: " + v("etc"));
      return l.join("\n");
    }

    function copyText(text) {
      const temp = document.createElement("textarea");
      temp.style.position = "fixed";
      temp.value = text;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      document.body.removeChild(temp);
    }

    function copyOutput() {
      copyText(document.getElementById("output").value);
      alert("복사되었습니다. 카카오톡에 붙여넣어 주세요.");
    }

    function startSurvey() {
      document.getElementById("intro").classList.add("hidden");
      document.getElementById("formContainer").classList.remove("hidden");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    document.getElementById("allInOneBtn").addEventListener("click", function () {
      if (!document.getElementById("privacyConsent").checked) {
        alert("개인정보 수집·이용에 동의해 주세요.");
        return;
      }
      this.disabled = true;
      this.textContent = "문진표 요약 및 전송 중...";
      const now = new Date();
      const summaryText = buildSummary(formatKoreanDateTime(now));
      document.getElementById("output").value = summaryText;
      copyText(summaryText);
      const data = collectFormData();
      data.summary_text = summaryText;
      sendToServer(data);
      alert("문진 요약이 자동으로 복사되었습니다.\n확인 버튼을 누르면 카카오톡으로 이동합니다.\n채팅창에 꼭 '붙여넣기'하여 보내주세요.");
      window.location.href = KAKAO_URL;
    });
  </script>
</body>
</html>
